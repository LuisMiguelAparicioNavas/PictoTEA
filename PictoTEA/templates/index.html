<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/styleIndex.css">
    <title>PictoTEA</title>
</head>
<body>
  <header class="app-header">
    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/457fa967093b92407aaa13268b7d397b963dcbce?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="PictoTEA Logo" class="app-logo" />
    <h1 class="app-title">PictoTEA</h1>
    <nav class="main-nav">
      <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/0e32348f5f5c862510f61e25587f41b98423bd7f?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="Home Icon" class="nav-icon" />
      <a href="#" class="nav-link nav-link-home">Pagina principal</a>
      <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/816f32e9d79d2195d1943e6f147b39579919548f?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="Pictos Icon" class="nav-icon" />
      <a href="#" class="nav-link">Pictos</a>
    </nav>
  </header>
  
  <main class="main-content">
    <section class="phrases-section">
      <h2 class="phrases-title">Tus frases</h2>
      <h3 class="question-title">¬øQue quieres decir?</h3>
  
      <div class="phrase-display">
        <p class="current-phrase">Quiero Comer</p>
        <div class="phrase-actions">
          <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/c3b5fdf1c90396ca48910c7f4d39f6b11fe1c456?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="Action Icon 1" class="action-icon" />
          <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/35e8cd3fab0d131bb733ee38267276ce67c316ce?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="Action Icon 2" class="action-icon-large" />
        </div>
      </div>
  
      <section class="word-cards" data-el="div-1">
        <div class="word-cards-container">
          <article class="word-card">
            <div class="word-card-content">
              <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/ca6493e3da8529ecb84697c3096eb4be87d9a89a?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="Quiero Icon" class="word-image" />
              <p class="word-text">Quiero</p>
            </div>
          </article>
          <article class="word-card">
            <div class="word-card-content word-card-content-active">
              <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/1bfcb48f8f20a05af98ef7dabc8cc8121d0a77e4?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="Comer Icon" class="word-image" />
              <p class="word-text">Comer</p>
            </div>
          </article>
        </div>
      </section>
  
      <button class="add-button">
        <span class="add-button-text">A√±adir</span>
        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/0998c952f9d4f1c368ffa4d6ab7d885786255766?placeholderIfAbsent=true&apiKey=1990fdc6afa74950a01ba6bbdcea8551" alt="Add Icon" class="add-icon" />
      </button>
    </section>
  </main>
  
  <footer class="app-footer">
    <button class="logout-button">Cerrar sesi√≥n</button>
  </footer>  
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Prueba Whisper API</title>
  <style>
    body { font-family: Arial; margin: 2em; }
    button { padding: 10px 20px; font-size: 16px; }
    p { margin-top: 20px; font-size: 18px; color: #333; }
  </style>
</head>
<body>

  <h1>üéôÔ∏è Transcripci√≥n con Whisper API</h1>
  <button onclick="startRecording()">Grabar</button>
  <p id="output">Aqu√≠ aparecer√° la transcripci√≥n...</p>

  <script>
    let mediaRecorder, audioChunks = [], silenceStart = null;

    async function startRecording() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const audioContext = new AudioContext();
      const source = audioContext.createMediaStreamSource(stream);
      const processor = audioContext.createScriptProcessor(2048, 1, 1);

      processor.onaudioprocess = e => {
        const input = e.inputBuffer.getChannelData(0);
        const silent = input.every(sample => Math.abs(sample) < 0.01);

        if (!silent) {
          silenceStart = null;
        } else {
          if (!silenceStart) silenceStart = Date.now();
          else if (Date.now() - silenceStart > 1500) {
            stopRecording();
            source.disconnect();
            processor.disconnect();
            stream.getTracks().forEach(t => t.stop());
          }
        }
      };

      source.connect(processor);
      processor.connect(audioContext.destination);

      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) audioChunks.push(e.data);
      };
      mediaRecorder.onstop = sendAudio;
      mediaRecorder.start();
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== "inactive") {
        mediaRecorder.stop();
      }
    }

    function sendAudio() {
      const blob = new Blob(audioChunks, { type: "audio/wav" });
      const form = new FormData();
      form.append("audio", blob, "recording.wav");

      fetch("/transcribe", { method: "POST", body: form })
        .then(r => r.json())
        .then(data => {
          document.getElementById("output").textContent =
            data.error ?? data.text;
        });
    }
  </script>
</body>
</html>
